#!/bin/bash
# stream videoes with mpv using resolution found with xrandr
# 		dependencies: 	xrandr
# 							mpv

helpText() {
	echo "Usage: $(basename $0) URL"
	echo
	echo "Opens mpv in fullscreen streaming URL in the resolution found on first monitor."
	exit 0
}

# check dependencies
if [[ ! $(command -v xrandr) ]]; then
	echo "Error: xrandr is not installed."
	exit 1
fi

if [[ ! $(command -v mpv) ]]; then
	echo "Error: mpv is not installed."
	exit 1
fi

# check number of arguments.
if [[ $# != 1 ]] ; then
	echo "Error: Wrong number of arguments!"
	echo
	helpText
fi

# check if argument 1 is an url.
if [[ $(echo $1 | awk '/^https:\/\/|^http:\/\// {print}') ]]; then
	sourceURL=$1
else
	echo "Error: $1 is not a valid URL!"
	echo
	helpText
fi

# get vertical resolution on first monitor
resolution=$(xrandr | grep -m 1 "\*" | tr -s " " | cut -d " " -f 2 | cut -d "x" -f 2)

# start streaming the video
echo "Starting video in $resolution."
mpv --fs --ytdl-format="best[height<=$resolution]" sourceURL
