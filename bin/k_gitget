#!/bin/bash
# pull all git and subgits from folder

targetPath=$(pwd)


helpText() {
	echo "Pull all git and subgits within folder."
	echo
	echo "	$(basename $0) 			Pull from current folder."
	echo "	$(basename $0) [folder path] 	Pull from specified folder."
	exit 0
}


findGits() {
	targetGits=$(find $targetPath -type d -name .git)
	if ! [[ $targetGits ]]; then
		echo "Error: No .git found."
		helpText
	fi
}


pullFrom() {
	for gitFolder in $targetGits; do
		cd $(dirname $gitFolder) && git checkout master && git up
	done
}


# check for too many arguments
if [[ $2 ]]; then
	echo "Error: Too many arguments."
	helpText
fi


# check for argument
if [[ $1 ]]; then
	if [[ $1 == "help" ]]; then
		helpText
	# check for non valid folder path in argument
	elif ! [[ -d $1 ]]; then
		echo "Error: $1 is not a valid folder path."
		helpText
	# run program with argument
	else
		targetPath=$1
		findGits
		pullFrom
	fi
# run program without argument
else
	findGits
	pullFrom
fi
